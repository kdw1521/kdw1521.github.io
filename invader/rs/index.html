<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>겹치는 이메일 찾기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bd:#ccd1d7; --bg:#f6f7f9; --fg:#111; }
    html,body{margin:0;padding:20px;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif}
    .wrap{max-width:960px;margin:0 auto}
    h1{margin:0 0 12px;font-size:20px}
    label{display:block;font-weight:600;margin:12px 0 8px}
    textarea{width:100%;min-height:220px;padding:12px;border:1px solid var(--bd);border-radius:12px;background:#fff;resize:vertical;line-height:1.5;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .row{display:grid;grid-template-columns:1fr;gap:16px}
    .controls{display:flex;gap:10px;align-items:center;margin:14px 0 18px}
    button{cursor:pointer;border:0;border-radius:10px;padding:10px 16px;font-weight:700}
    .primary{background:#111;color:#fff}
    .ghost{background:#e9eef5;color:#111}
    .stats{font-size:12px;color:#666;margin-left:auto}
    /* 결과 영역은 부분 색상 강조를 위해 textarea 스타일의 div 사용 */
    .output{width:100%;min-height:160px;padding:12px;border:1px solid var(--bd);border-radius:12px;background:#fff;white-space:pre-wrap;line-height:1.6;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .red{color:#d01717}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>겹치는 이메일 찾기</h1>

    <label for="a">결제자</label>
    <textarea id="a" placeholder="한 줄당 하나의 이메일을 붙여넣기"></textarea>

    <label for="b">신청자</label>
    <textarea id="b" placeholder="한 줄당 하나의 엑셀 row 붙여넣기"></textarea>

    <div class="controls">
      <button id="run" class="primary">겹치는것 찾기</button>
      <button id="clear" class="ghost">지우기</button>
      <div id="stats" class="stats"></div>
    </div>

    <label for="result">겹치는 데이터</label>
    <div id="result" class="output" aria-live="polite"></div>
  </div>

  <script>
    // 결제자: 이메일만 붙여넣는 영역
    function parseEmails(text){
      const chunks = text.split(/[\r\n,]+/);
      const out = [];
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/i;
      for (let c of chunks){
        if (!c) continue;
        c = c.trim().replace(/[<>"'()]/g,'');
        if (c === '---' || c === '—') continue;
        if (re.test(c)) out.push(c);
      }
      return out;
    }
    const toLowerSet = arr => new Set(arr.map(v => v.toLowerCase()));

    // 신청자: 한 줄에 "이메일 [탭/공백] 기타컬럼..." 형태
    function parseApplicants(text){
      const lines = text.split(/\r?\n/);
      const emailRe = /[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/; // 첫 이메일만
      const entries = []; // 입력 순서 유지
      const emailSet = new Set();
      for (const raw of lines){
        if (!raw.trim()) continue;
        const m = raw.match(emailRe);
        if (!m) continue;
        const email = m[0];
        const lower = email.toLowerCase();
        entries.push({ lower, line: raw });
        emailSet.add(lower);
      }
      return { entries, emailSet };
    }

    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

    function run(){
      const aInput = document.getElementById('a').value;
      const bInput = document.getElementById('b').value;

      const aSet = toLowerSet(parseEmails(aInput));               // 결제자 고유 이메일
      const { entries, emailSet: bEmailSet } = parseApplicants(bInput); // 신청자 라인+이메일

      // 입력 순서를 유지하여 매칭 라인만 수집
      const matches = [];
      for (const { lower, line } of entries){
        if (aSet.has(lower)) matches.push({ email: lower, line });
      }

      const result = document.getElementById('result');
      if (matches.length){
        // 라인 내 첫 이메일만 강조
        const html = matches.map(({ email, line }) =>
          line.replace(new RegExp(escapeRegExp(email), 'i'), '<span class="red">$&</span>')
        ).join('\n');
        result.innerHTML = html;
      } else {
        result.textContent = '겹치는 이메일 없음';
      }

      document.getElementById('stats').textContent =
        `A(결제자): ${aSet.size} · B(신청자 이메일): ${bEmailSet.size} · 겹치는 것: ${matches.length}`;
    }

    function clearAll(){
      document.getElementById('a').value = '';
      document.getElementById('b').value = '';
      document.getElementById('result').textContent = '';
      document.getElementById('stats').textContent = '';
    }

    document.getElementById('run').addEventListener('click', run);
    document.getElementById('clear').addEventListener('click', clearAll);
  </script>

</body>
</html>
